<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" id="tab-favicon" href="clever.png" />
    <title id="t">Clever | Log in</title>
    <script>
        window.onbeforeunload = function (e) {
            return 'Are you sure you want to leave this page?  You will lose any unsaved data.';
        };
    </script>

    <script>
        if ("serviceWorker" in navigator) {
            window.addEventListener("load", () => {
                navigator.serviceWorker.register("/uv/sw.js");
            });
        }
    </script>
    <script>
        document.onkeydown = function (e) {
            if (e.keyCode == 123) {
                return false;
            }
            if (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) {
                return false;
            }
            if (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) {
                return false;
            }
            if (e.ctrlKey && e.keyCode == 'S'.charCodeAt(0)) {
                return false;
            }
            if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) {
                return false;
            }
            if (e.ctrlKey && e.shiftKey && e.keyCode == 'C'.charCodeAt(0)) {
                return false;
            }
        }
        document.addEventListener('contextmenu',

            event => event.preventDefault()

        )
    </script>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            background: #0f0f0f;
            font-family: system-ui, sans-serif;
            height: 100vh;
        }

        .browser {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .tabs-bar {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px;
            background: #1a1a1a;
        }

        .address-container {
            flex: 2;
            display: flex;
        }

        #outerAddressForm {
            display: flex;
            width: 100%;
        }

        #addressInput {
            flex: 1;
            padding: 6px 10px;
            border-radius: 8px;
            border: none;
            outline: none;
            background: #2a2a2a;
            color: #f5f5f5;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            gap: 6px;
            flex: 3;
            overflow-x: auto;
        }

        .tab {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: #2a2a2a;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            white-space: nowrap;
        }

        .tab.active {
            background: #3a3a3a;
        }

        .tab button {
            background: none;
            border: none;
            color: #aaa;
            cursor: pointer;
        }

        .tab button:hover {
            color: #ff5555;
        }

        .tab-icon {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            object-fit: cover;
        }

        .tab-audio {
            font-size: 14px;
        }

        #newTabBtn {
            border: none;
            background: #2a2a2a;
            color: white;
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
        }

        #newTabBtn:hover {
            background: #3a3a3a;
        }

        .content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: black;
        }

        .content {
            flex: 1;
            position: relative;
            background: black;
            overflow: hidden;
        }

        iframe {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            border: none;
            display: none;
        }
    </style>
</head>

<body>

    <div class="browser">
        <div class="tabs-bar">
            <div class="address-container">
                <form id="outerAddressForm">
                    <input id="addressInput"
                           type="text"
                           placeholder="Search or enter URL"
                           autocomplete="off" />
                </form>
            </div>

            <div class="tabs" id="tabs"></div>

            <button id="newTabBtn">+</button>
        </div>

        <div class="content-wrapper">
            <div class="content" id="content"></div>
        </div>
    </div>

    <script>
        const tabsEl = document.getElementById("tabs");
        const contentEl = document.getElementById("content");
        const newTabBtn = document.getElementById("newTabBtn");
        const addressForm = document.getElementById("outerAddressForm");
        const addressInput = document.getElementById("addressInput");

        const CHROME_NEW_TAB_ICON =
            "data:image/svg+xml;utf8," +
            "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'>" +
            "<rect width='16' height='16' rx='4' ry='4' fill='%232196f3'/>" +
            "<circle cx='8' cy='8' r='4.5' fill='white'/>" +
            "<path d='M8 5.5v5M5.5 8h5' stroke='%232196f3' stroke-width='1.2' stroke-linecap='round'/>" +
            "</svg>";

        const STORAGE_KEY = "kvproxy_tabs_outerbar_v1";

        let state = {
            tabs: [],
            active: null
        };

        function save() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            } catch (e) {
                console.error("Failed to save state", e);
            }
        }

        function load() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const parsed = JSON.parse(saved);
                    if (parsed && Array.isArray(parsed.tabs)) {
                        state = parsed;
                    }
                }
            } catch (e) {
                console.error("Failed to load state, clearing", e);
                localStorage.removeItem(STORAGE_KEY);
                state = { tabs: [], active: null };
            }
        }

        function makeId() {
            if (window.crypto && crypto.randomUUID) return crypto.randomUUID();
            return Date.now().toString(36) + Math.random().toString(36).slice(2);
        }

        function getActiveTab() {
            return state.tabs.find(t => t.id === state.active) || null;
        }

        function getActiveIframe() {
            const active = getActiveTab();
            if (!active) return null;
            return contentEl.querySelector(`iframe[data-id="${active.id}"]`);
        }

        function updateAddressInput() {
            const active = getActiveTab();
            addressInput.value = active?.lastAddress || "";
        }

        function createIframeForTab(tab) {
            const iframe = document.createElement("iframe");
            iframe.src = "tabs.html";
            iframe.dataset.id = tab.id;

            iframe.addEventListener("load", () => {
                if (tab.lastAddress) {
                    try {
                        iframe.contentWindow.postMessage(
                            { type: "kv-restore", address: tab.lastAddress },
                            "*"
                        );
                    } catch (e) {
                        console.error("Failed to send restore message", e);
                    }
                }
            });

            contentEl.appendChild(iframe);
        }

        function newTab() {
            const id = makeId();
            const tab = {
                id,
                lastAddress: "",
                title: "",
                favicon: "",
                isAudio: false
            };

            state.tabs.push(tab);
            state.active = id;

            createIframeForTab(tab);
            save();
            render();
            updateAddressInput();
        }

        function closeTab(id) {
            state.tabs = state.tabs.filter(t => t.id !== id);

            const iframe = contentEl.querySelector(`iframe[data-id="${id}"]`);
            if (iframe) iframe.remove();

            if (state.active === id) {
                state.active = state.tabs[state.tabs.length - 1]?.id || null;
            }

            save();
            render();
            updateAddressInput();
        }

        function activate(id) {
            state.active = id;
            save();
            render();
            updateAddressInput();
        }

        function render() {
            tabsEl.innerHTML = "";

            state.tabs.forEach((tab) => {
                const el = document.createElement("div");
                el.className = "tab" + (tab.id === state.active ? " active" : "");
                el.onclick = () => activate(tab.id);

                const icon = document.createElement("img");
                icon.className = "tab-icon";
                icon.src = tab.favicon || CHROME_NEW_TAB_ICON;
                icon.alt = "";

                const label = document.createElement("span");
                const rawTitle = (tab.title || "").trim();
                const fallback = "New Tab";
                let labelText = rawTitle || fallback;
                if (labelText.length > 25) {
                    labelText = labelText.slice(0, 22) + "...";
                }
                label.textContent = labelText;

                const audioIndicator = document.createElement("span");
                audioIndicator.className = "tab-audio";
                audioIndicator.textContent = tab.isAudio ? "ðŸ”Š" : "";

                const closeBtn = document.createElement("button");
                closeBtn.textContent = "âœ•";
                closeBtn.onclick = (e) => {
                    e.stopPropagation();
                    closeTab(tab.id);
                };

                el.appendChild(icon);
                el.appendChild(label);
                el.appendChild(audioIndicator);
                el.appendChild(closeBtn);
                tabsEl.appendChild(el);
            });

            contentEl.querySelectorAll("iframe").forEach(iframe => {
                iframe.style.display = iframe.dataset.id === state.active ? "block" : "none";
            });
        }

        addressForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const address = addressInput.value.trim();
            if (!address) return;

            const active = getActiveTab();
            if (!active) return;

            const iframe = getActiveIframe();
            if (!iframe) return;

            active.lastAddress = address;
            save();

            try {
                iframe.contentWindow.postMessage(
                    { type: "kv-navigate", address },
                    "*"
                );
            } catch (err) {
                console.error("Failed to send navigate message", err);
            }
        });

        window.addEventListener("message", (e) => {
            const data = e.data;
            if (!data || !data.type) return;

            const iframes = Array.from(document.querySelectorAll("iframe"));
            const iframe = iframes.find(f => f.contentWindow === e.source);
            if (!iframe) return;

            const tab = state.tabs.find(t => t.id === iframe.dataset.id);
            if (!tab) return;

            if (data.type === "kv-url") {
                const address = data.address || "";
                if (address) {
                    tab.lastAddress = address;
                    save();
                    if (tab.id === state.active) {
                        updateAddressInput();
                    }
                }
            } else if (data.type === "kv-title") {
                tab.title = data.title || "";
                save();
                render();
            } else if (data.type === "kv-favicon") {
                tab.favicon = data.favicon || "";
                save();
                render();
            } else if (data.type === "kv-audio") {
                tab.isAudio = !!data.isAudio;
                save();
                render();
            }
        });

        load();

        if (state.tabs.length === 0) {
            newTab();
        } else {
            state.tabs.forEach(tab => {
                if (typeof tab.title !== "string") tab.title = "";
                if (typeof tab.favicon !== "string") tab.favicon = "";
                if (typeof tab.isAudio !== "boolean") tab.isAudio = false;
                createIframeForTab(tab);
            });
            if (!state.active && state.tabs.length) {
                state.active = state.tabs[0].id;
            }
            render();
            updateAddressInput();
        }

        newTabBtn.onclick = newTab;
    </script>
<!-- PopAds Code -->
<script type="text/javascript" data-cfasync="false">
/*<![CDATA[/* */
(function(){
    var p = window,
        x = "dc51e6419d6fca60eb7a5aeeda5b4503",
        a = [
            ["siteId", 698-552+465*629-437+4979973],
            ["minBid", 0],
            ["popundersPerIP", "0"],
            ["delayBetween", 0],
            ["default", false],
            ["defaultPerDay", 0],
            ["topmostLayer", "auto"]
        ],
        r = [
            "d3d3LmRpc3BsYXl2ZXJ0aXNpbmcuY29tL29qc29uZWRpdG9yLm1pbi5jc3M=",
            "ZDNtem9rdHk5NTFjNXcuY2xvdWRmcm9udC5uZXQvZHhxcUhrL2xodW1hbmUubWluLmpz"
        ],
        e = -1, u, l,
        w = function () {
            clearTimeout(l); e++;
            if (r[e] && !(1795559479000 < (new Date).getTime() && 1 < e)) {
                u = p.document.createElement("script");
                u.type = "text/javascript"; u.async = true;
                var c = p.document.getElementsByTagName("script")[0];
                u.src = "https://" + atob(r[e]);
                u.crossOrigin = "anonymous";
                u.onerror = w;
                u.onload = function () {
                    clearTimeout(l);
                    p[x.slice(0,16) + x.slice(0,16)] || w();
                };
                l = setTimeout(w, 5000);
                c.parentNode.insertBefore(u, c);
            }
        };
    if (!p[x]) {
        try { Object.freeze(p[x] = a); } catch (e) {}
        w();
    }
})();
 /*]]>/* */
</script>
<!-- End PopAds -->

</body>
</html>
